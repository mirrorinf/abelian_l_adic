\begin{cthm}
    如果$E$定义的$\ell$进表示$\rho_{\ell}$满足：存在理想$\mathfrak{m}$和$\mathbb{Q}$代数群的态射$\phi: S_{\mathfrak{m}}\to \mathrm{GL}(V)$使得$\rho_{\ell} = \phi_{\ell}$. 那么$E$在$K$上有复乘.
\end{cthm}

\begin{proof}
    假设$E$在$K$上没有复乘.
    $\phi$定义了有一族严格相容的Galois表示$\{\phi_{\ell'}\}$.
    由定理\ref{reps::finite_diagonal}，可以选取一个$\ell'$使得$\phi_{\ell'}$在$\mathbb{Q}_{\ell'}$上就可以对角化. 
    由于$\phi_{\ell}$和$\rho_{\ell}$相容，$\phi_{\ell'}$与$\rho_{\ell}$也相容.
    $\rho_{\ell'}$是不可约的，而已知$\phi_{\ell}$是半单的. 那么$\phi_{\ell'}\cong \rho_{\ell'}$.
    即$\rho_{\ell'}$是对角化的，但这与不可约性矛盾.
\end{proof}

\begin{ccor}
    如果$E$定义的$\ell$进表示$\rho_{\ell}$是局部代数的，则$E$在$K$上有复乘. \label{reps::when_cm}
\end{ccor}

\begin{ccor}
    如果$E$定义的$\ell$进表示是交换的，则$E$在$K$上有复乘.
\end{ccor}

由于Galois群是紧的，$G_{\ell} = \mathrm{Im}(\rho_\ell)$是$\mathrm{GL}_2(\mathbb{Q}_{\ell})$的闭子群. 由非阿基米德的Cartan定理，$\mathrm{Im}(\rho_{\ell})$是一个$\ell$进李群. 令$\mathfrak{g}_{\ell}$为其李代数.

\begin{proof}[定理\ref{main::open_image}的证明]
    只需要证明$\mathfrak{g}_{\ell} = \mathrm{End}(V_{\ell})$.

    $E$在$K$的所有有限扩张上都没有复乘，从而$G_{\ell}$的任何开子群$U$，$V_{\ell}$都是不可约的$U$模. 那么，$V_{\ell}$是不可约的$\mathfrak{g}_{\ell}$模. 由Schur引理，中心化子$C(\mathfrak{g}_{\ell})$是一个域. 但是$\mathrm{dim}\ V_{\ell}=2$，所以$C(\mathfrak{g}_{\ell})$或者是$\mathbb{Q}_{\ell}$，或者是$\mathbb{Q}_{\ell}$的二次扩张.

    如果$C(\mathfrak{g}_{\ell}) = \mathbb{Q}_{\ell}$，则$\mathfrak{g}_{\ell}$或者是$\mathrm{End}(V_{\ell})$，或者是$\mathfrak{sl}(V_{\ell})$. 但如果$\mathfrak{g}_{\ell} = \mathfrak{sl}(V_{\ell})$，$\mathfrak{g}_{\ell}$在$\wedge^2 V_{\ell}$上的作用是平凡的. 但是由Weil配对，$\wedge^2 V_{\ell}$作为Galois模与$T_{\ell}(\mu)\otimes \mathbb{Q}_{\ell}$同构，矛盾.

    如果$C(\mathfrak{g}_{\ell}) = F$是$\mathbb{Q}_{\ell}$的一个二次扩张，则
    $\mathfrak{g}_{\ell}\subset C(F)) = F$是交换的. 那么$G_{\ell}$有一个交换的开子群.
    取$L$为$K$的有限扩张，使得$\rho_{\ell}$在$\mathrm{Gal}(\overline{K}/L)$上的限制是交换的.
    此时$E$在$L$上有复乘.

\end{proof}
